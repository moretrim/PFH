# `create_vassal` has a very debilitating shortcoming when making a vassal out of a country which
# holds core provinces of the new overlord. In such a case, these cores end up ***randomly
# scrambled*** between vassal and master.
#
# To work around the issue, overlord cores are temporarily converted into UTI cores only to be
# restored after the fact. Unfortunately because `FROM` is not a valid argument to `remove_core`,
# this workaround cannot be fully refactored and the initial core conversion has to be performed
# before sending this event (see comment).
#
# This shortcut can only be used when `THIS` is the new overlord. Otherwise, the full workaround has
# to be written in-place.
country_event = {
    id      = 250000
    title   = cch.create-vassal.name
    desc    = cch.create-vassal.desc
    picture = TBD

    is_triggered_only = yes
    allow_multiple_instances = yes

    immediate = {
        # This would allow a full refactor:
        #
        #    FROM = {
        #        all_core = {
        #            limit = {
        #                owned_by = THIS
        #            }
        #
        #            add_core = UTI
        #            # ==> N.b. the following is not valid! <==
        #            remove_core = FROM
        #        }
        #    }
        #
        # Calling code should instead perform the above before sending this event.

        FROM = { create_vassal = THIS }

        UTI = {
            all_core = {
                add_core = FROM
                remove_core = UTI
            }
        }
    }

    option = {
        name = cch.create-vassal.opt0
    }
}

# Modelled after 96085 which, amongst other uses, enforces democracy on behalf of the
# install_democracy CB. The difference is that we avoid a forced peace with all belligerent, which
# can have unforeseen consequences.
country_event = {
    id      = 250100
    title   = cch.enforced-democracy.name
    desc    = cch.enforced-democracy.desc
    picture = unite

    news             = yes
    news_title       = cch.enforced-democracy.news.title
    news_desc_long   = cch.enforced-democracy.news.long
    news_desc_medium = cch.enforced-democracy.news.medium
    news_desc_short  = cch.enforced-democracy.news.short

    is_triggered_only = yes

    immediate = {
        government = democracy
        ruling_party_ideology = liberal
        political_reform = universal_weighted_voting
        political_reform = population_equal_weight
        political_reform = yes_meeting
        political_reform = free_press
        political_reform = non_socialist
        political_reform = gerrymandering
        political_reform = non_secret_ballots
        clr_country_flag = communist_gov
        clr_country_flag = absolute_monarchy_gov
        clr_country_flag = semi_constitutional_monarchy_gov
        clr_country_flag = constitutional_monarchy_gov
        set_country_flag = democracy_gov
        clr_country_flag = presidential_dictatorship_gov
        clr_country_flag = fascist_gov
        clr_country_flag = anarcho_liberal_gov
    }

    option = {
        name = cch.enforced-democracy.opt0

        random_country = {
            limit = {
                is_sphere_leader_of = THIS
                NOT = { has_country_flag = friendly_democracy }
            }

            diplomatic_influence = { who = THIS value = -100 }
        }

        random_country = {
            limit = {
                has_country_flag = friendly_democracy
                truce_with = THIS
            }

            relation = { who = THIS value = 400 }
            random_owned = {
                limit = {
                    owner = { is_greater_power = yes }
                }

                owner = {
                    diplomatic_influence = { who = THIS value = 100 }
                }
            }

            create_alliance = THIS
            clr_country_flag = friendly_democracy
        }

        capital_scope = {
            any_pop = {
                limit = { literacy = 0.2 }

                ideology = { factor = 0.1 value = liberal }
                ideology = { factor = -0.5 value = communist }
            }
        }

        any_pop = {
            limit = { location = { is_colonial = no } }

            ideology = { factor = -0.1 value = communist }

            scaled_militancy = {
                ideology = reactionary
                factor = 6
            }

            scaled_militancy = {
                ideology = communist
                factor = 6
            }

            scaled_militancy = {
                ideology = fascist
                factor = 6
            }

            scaled_militancy = {
                ideology = liberal
                factor = -4
            }
        }
    }
}

# Modelled after e.g. unite_with_greece: when two countries with close affinity merge into one, and
# it feels fair to extend to a human player an 'out' by having them take over the AI country that
# would otherwise be inheriting them. In the following "country A swap-unites with country B into C"
# means:
#
# - B is the larger country of the two whereas A is the smaller one: here larger/smaller is really
#   about the particular kind of affinity between the source countries, e.g. USA inheriting
#   California or Greece inheriting Crete
#
# - the process ends with only C (which can be B, and possibly also A but that would be unusual)
#
# Swap-unification goes as follows:
#
# - the 'larger' B inherits the 'smaller' A  and becomes C; only if both countries are AI or both
#   countries are players
#
# - A inherits B while also 'copying' it as best as possible, then becomes C; only if A is a
#   player and B is AI
#
# - A petitions B for unification; only if A is an AI and B is a player
#
# This last alternative can be a notification event, or can directly lead to inheritance. Conditions
# on the first and third alternative can be tweaked to turn the petition into a suicide button for
# A, but only through bilateral rather than unilateral agreement (refer to model unite_with_greece).
#
# The last alternative is optional in that it can be merged into the first, by relaxing its
# condition from equality to implication (i.e. B is a player *or* A is an AI).
#
# Note that copying a country can involve the following:
# - moving A's capital to B's
# - duplicating the political system
# - handling primary & accepted cultures
# - handling behind-the-scenes flags & variables
#
# Take also care of Westernisation status as it's not unusual that A should be Westernised e.g. to
# avoid creating colonial provinces.
#
# Recipe for copying the political system of FROM into THIS (which sadly doesn't seem possible to
# turn into its own event):
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = { government = theocracy }
#     }
#
#     government = theocracy
#     clr_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
#     set_country_flag = theocratic_government
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = {
#             government = absolute_monarchy
#             government = colonial_company
#         }
#     }
#
#     government = absolute_monarchy
#     clr_country_flag = communist_gov
#     set_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = { government = prussian_constitutionalism }
#     }
#
#     government = prussian_constitutionalism
#     clr_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     set_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = {
#             OR = {
#                 government = hms_government
#                 government = french_bourbon
#                 government = dominion
#             }
#         }
#     }
#
#     government = hms_government
#     clr_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     set_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = { government = democracy }
#     }
#
#     government = democracy
#     clr_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     set_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = { government = presidential_dictatorship }
#     }
#
#     government = presidential_dictatorship
#     clr_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     set_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = { government = proletarian_dictatorship }
#     }
#
#     government = proletarian_dictatorship
#     set_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = { government = fascist_dictatorship }
#     }
#
#     government = fascist_dictatorship
#     clr_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     set_country_flag = fascist_gov
#     clr_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
#
# random_country = {
#     limit = {
#         tag = THIS
#         FROM = { government = bourgeois_dictatorship }
#     }
#
#     government = bourgeois_dictatorship
#     clr_country_flag = communist_gov
#     clr_country_flag = absolute_monarchy_gov
#     clr_country_flag = semi_constitutional_monarchy_gov
#     clr_country_flag = constitutional_monarchy_gov
#     clr_country_flag = democracy_gov
#     clr_country_flag = presidential_dictatorship_gov
#     clr_country_flag = fascist_gov
#     set_country_flag = anarcho_liberal_gov
#     clr_country_flag = everywhere_genocide_only
#     clr_country_flag = non_colonial_genocide_only
#     clr_country_flag = colonial_genocide_only
#     clr_country_flag = preparations_to_kill
#     remove_country_modifier = preparations_to_kill
# }
