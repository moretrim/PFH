#!/usr/bin/env bash

## Section fragments

# the output of General.markdown is manually spliced into Main.markdown, with help from lossy roundtrip shenanigans
pandoc -so fragment.General.markdown --to gfm --filter pandoc-citeproc General.markdown
pandoc -o fragment.General.markdown --from gfm fragment.General.markdown

# the rest is autogenerated, to be assembled later
for fragment in Elections.markdown Parties.markdown ; do
    pandoc -so "fragment.${fragment%.markdown}.json" --filter pandoc-citeproc "$fragment"
done

## Main document

pandoc -so Main.json --filter pandoc-citeproc Main.markdown

## Assemble everything

pandoc -so bibliography.html              --filter pandoc-citeproc Main.json fragment.*.json
pandoc -so bibliography.markdown --to gfm --filter pandoc-citeproc Main.json fragment.*.json
